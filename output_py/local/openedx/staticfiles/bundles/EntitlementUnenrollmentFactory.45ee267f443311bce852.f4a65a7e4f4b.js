!function(e,t){for(var n in t)e[n]=t[n]}(window,webpackJsonp([54],{"./lms/static/js/learner_dashboard/entitlement_unenrollment_factory.js":function(e,t,n){"use strict";function r(e){return new o.a(e)}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"EntitlementUnenrollmentFactory",function(){return r});var o=n("./lms/static/js/learner_dashboard/views/entitlement_unenrollment_view.js")},"./lms/static/js/learner_dashboard/views/entitlement_unenrollment_view.js":function(e,t,n){"use strict";(function(e){function r(e){"@babel/helpers - typeof";return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function u(e,t){return(u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e){var t=h();return function(){var n,r=f(e);if(t){var o=f(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return d(this,n)}}function d(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var p=n(2),b=n.n(p),y=n("./node_modules/edx-ui-toolkit/src/js/utils/html-utils.js"),v=n.n(y),w=function(t){function n(e){i(this,n);var t={el:".js-entitlement-unenrollment-modal"};return r.call(this,o({},t,e))}a(n,t);var r=c(n);return l(n,[{key:"initialize",value:function(t){var n=this;this.closeButtonSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-close-btn",this.headerTextSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-header-text",this.errorTextSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-error-text",this.submitButtonSelector=".js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-submit",this.triggerSelector=".js-entitlement-action-unenroll",this.mainPageSelector="#dashboard-main",this.genericErrorMsg=gettext("Your unenrollment request could not be processed. Please try again later."),this.modalId="#".concat(this.$el.attr("id")),this.dashboardPath=t.dashboardPath,this.signInPath=t.signInPath,this.browseCourses=t.browseCourses,this.isEdx=t.isEdx,this.$submitButton=e(this.submitButtonSelector),this.$closeButton=e(this.closeButtonSelector),this.$headerText=e(this.headerTextSelector),this.$errorText=e(this.errorTextSelector),this.$submitButton.on("click",this.handleSubmit.bind(this)),e(this.triggerSelector).each(function(){var t=e(this);t.on("click",n.handleTrigger.bind(n)),window.accessible_modal&&window.accessible_modal("#".concat(t.attr("id")),n.closeButtonSelector,"#".concat(n.$el.attr("id")),n.mainPageSelector)})}},{key:"handleTrigger",value:function(t){var n=e(t.target),r=n.data("courseName"),o=n.data("courseNumber"),i=n.data("entitlementApiEndpoint");this.$previouslyFocusedElement=n,this.resetModal(),this.setHeaderText(r,o),this.setSubmitData(i),this.$el.css("position","fixed")}},{key:"handleSubmit",value:function(){var t=this.$submitButton.data("entitlementApiEndpoint");if(void 0===t)return void this.setError(this.genericErrorMsg);this.$submitButton.prop("disabled",!0),e.ajax({url:t,method:"DELETE",complete:this.onComplete.bind(this)})}},{key:"resetModal",value:function(){this.$submitButton.removeData(),this.$submitButton.prop("disabled",!1),this.$headerText.empty(),this.$errorText.removeClass("entitlement-unenrollment-modal-error-text-visible"),this.$errorText.empty()}},{key:"setError",value:function(e){this.$submitButton.prop("disabled",!0),this.$errorText.empty(),v.a.setHtml(this.$errorText,e),this.$errorText.addClass("entitlement-unenrollment-modal-error-text-visible")}},{key:"setHeaderText",value:function(e,t){this.$headerText.empty(),v.a.setHtml(this.$headerText,v.a.interpolateHtml(gettext("Are you sure you want to unenroll from {courseName} ({courseNumber})? You will be refunded the amount you paid."),{courseName:e,courseNumber:t}))}},{key:"setSubmitData",value:function(e){this.$submitButton.removeData(),this.$submitButton.data("entitlementApiEndpoint",e)}},{key:"switchToSlideOne",value:function(){this.$(".entitlement-unenrollment-modal-inner-wrapper header").addClass("hidden"),this.$(".entitlement-unenrollment-modal-submit-wrapper").addClass("hidden"),this.$(".slide1").removeClass("hidden"),this.$(".entitlement-unenrollment-modal-inner-wrapper").prevObject.addClass("entitlement-unenrollment-modal-long-survey"),window.trapFocusForAccessibleModal(this.$previouslyFocusedElement,window.focusableElementsString,this.closeButtonSelector,this.modalId,this.mainPageSelector)}},{key:"switchToSlideTwo",value:function(){var e=this.$(".reasons_survey input[name='priceEntitlementUnenrollment']:checked").val(),t=this.$(".reasons_survey input[name='dissastisfiedEntitlementUnenrollment']:checked").val(),n=this.$(".reasons_survey input[name='difficultEntitlementUnenrollment']:checked").val(),r=this.$(".reasons_survey input[name='timeEntitlementUnenrollment']:checked").val(),o=this.$(".reasons_survey input[name='unavailableEntitlementUnenrollment']:checked").val(),i=this.$(".reasons_survey input[name='emailEntitlementUnenrollment']:checked").val();if(e||t||n||r||o||i){var s={price:e,dissastisfied:t,difficult:n,time:r,unavailable:o,email:i};window.analytics.track("entitlement_unenrollment_reason.selected",{category:"user-engagement",label:JSON.stringify(s),displayName:"v1"})}this.$(".slide1").addClass("hidden"),this.$(".slide2").removeClass("hidden"),this.$(".entitlement-unenrollment-modal-inner-wrapper").prevObject.removeClass("entitlement-unenrollment-modal-long-survey"),window.trapFocusForAccessibleModal(this.$previouslyFocusedElement,window.focusableElementsString,this.closeButtonSelector,this.modalId,this.mainPageSelector)}},{key:"onComplete",value:function(e){var t=e.status,r=e.responseJSON&&e.responseJSON.detail;204===t?this.isEdx?(this.switchToSlideOne(),this.$(".reasons_survey:first .submit-reasons").click(this.switchToSlideTwo.bind(this))):n.redirectTo(this.dashboardPath):401===t&&"Authentication credentials were not provided."===r?n.redirectTo("".concat(this.signInPath,"?next=").concat(encodeURIComponent(this.dashboardPath))):this.setError(this.genericErrorMsg)}}],[{key:"redirectTo",value:function(e){window.location.href=e}}]),n}(b.a.View);t.a=w}).call(t,n(0))}},["./lms/static/js/learner_dashboard/entitlement_unenrollment_factory.js"]));