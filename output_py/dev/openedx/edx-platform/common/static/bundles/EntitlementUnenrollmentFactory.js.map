{"version":3,"sources":["webpack:///./lms/static/js/learner_dashboard/entitlement_unenrollment_factory.js","webpack:///./lms/static/js/learner_dashboard/views/entitlement_unenrollment_view.js"],"names":["EntitlementUnenrollmentFactory","options","EntitlementUnenrollmentView","defaults","el","view","closeButtonSelector","headerTextSelector","errorTextSelector","submitButtonSelector","triggerSelector","mainPageSelector","genericErrorMsg","gettext","modalId","$el","attr","dashboardPath","signInPath","browseCourses","isEdx","$submitButton","$","$closeButton","$headerText","$errorText","on","handleSubmit","bind","each","setUpTrigger","$trigger","handleTrigger","window","accessible_modal","event","target","courseName","data","courseNumber","apiEndpoint","$previouslyFocusedElement","resetModal","setHeaderText","setSubmitData","css","undefined","setError","prop","ajax","url","method","complete","onComplete","removeData","empty","removeClass","message","HtmlUtils","setHtml","addClass","interpolateHtml","prevObject","trapFocusForAccessibleModal","focusableElementsString","price","val","dissastisfied","difficult","time","unavailable","email","results","analytics","track","category","label","JSON","stringify","displayName","xhr","status","responseJSON","detail","switchToSlideOne","click","switchToSlideTwo","redirectTo","encodeURIComponent","path","location","href","Backbone","View"],"mappings":"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","file":"EntitlementUnenrollmentFactory.js","sourcesContent":["import EntitlementUnenrollmentView from './views/entitlement_unenrollment_view';\n\nfunction EntitlementUnenrollmentFactory(options) {\n  return new EntitlementUnenrollmentView(options);\n}\n\nexport { EntitlementUnenrollmentFactory }; // eslint-disable-line import/prefer-default-export\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/entitlement_unenrollment_factory.js","/* globals gettext */\n\nimport Backbone from 'backbone';\n\nimport HtmlUtils from 'edx-ui-toolkit/js/utils/html-utils';\n\nclass EntitlementUnenrollmentView extends Backbone.View {\n  constructor(options) {\n    const defaults = {\n      el: '.js-entitlement-unenrollment-modal',\n    };\n    super(Object.assign({}, defaults, options));\n  }\n\n  initialize(options) {\n    const view = this;\n\n    this.closeButtonSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-close-btn';\n    this.headerTextSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-header-text';\n    this.errorTextSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-error-text';\n    this.submitButtonSelector = '.js-entitlement-unenrollment-modal .js-entitlement-unenrollment-modal-submit';\n    this.triggerSelector = '.js-entitlement-action-unenroll';\n    this.mainPageSelector = '#dashboard-main';\n    this.genericErrorMsg = gettext('Your unenrollment request could not be processed. Please try again later.');\n    this.modalId = `#${this.$el.attr('id')}`;\n\n    this.dashboardPath = options.dashboardPath;\n    this.signInPath = options.signInPath;\n    this.browseCourses = options.browseCourses;\n    this.isEdx = options.isEdx;\n\n    this.$submitButton = $(this.submitButtonSelector);\n    this.$closeButton = $(this.closeButtonSelector);\n    this.$headerText = $(this.headerTextSelector);\n    this.$errorText = $(this.errorTextSelector);\n\n    this.$submitButton.on('click', this.handleSubmit.bind(this));\n\n    $(this.triggerSelector).each(function setUpTrigger() {\n      const $trigger = $(this);\n\n      $trigger.on('click', view.handleTrigger.bind(view));\n\n      // From accessibility_tools.js\n      if (window.accessible_modal) {\n        window.accessible_modal(\n          `#${$trigger.attr('id')}`,\n          view.closeButtonSelector,\n          `#${view.$el.attr('id')}`,\n          view.mainPageSelector,\n        );\n      }\n    });\n  }\n\n  handleTrigger(event) {\n    const $trigger = $(event.target);\n    const courseName = $trigger.data('courseName');\n    const courseNumber = $trigger.data('courseNumber');\n    const apiEndpoint = $trigger.data('entitlementApiEndpoint');\n\n    this.$previouslyFocusedElement = $trigger;\n\n    this.resetModal();\n    this.setHeaderText(courseName, courseNumber);\n    this.setSubmitData(apiEndpoint);\n    this.$el.css('position', 'fixed');\n  }\n\n  handleSubmit() {\n    const apiEndpoint = this.$submitButton.data('entitlementApiEndpoint');\n\n    if (apiEndpoint === undefined) {\n      this.setError(this.genericErrorMsg);\n      return;\n    }\n\n    this.$submitButton.prop('disabled', true);\n    $.ajax({\n      url: apiEndpoint,\n      method: 'DELETE',\n      complete: this.onComplete.bind(this),\n    });\n  }\n\n  resetModal() {\n    this.$submitButton.removeData();\n    this.$submitButton.prop('disabled', false);\n    this.$headerText.empty();\n    this.$errorText.removeClass('entitlement-unenrollment-modal-error-text-visible');\n    this.$errorText.empty();\n  }\n\n  setError(message) {\n    this.$submitButton.prop('disabled', true);\n    this.$errorText.empty();\n    HtmlUtils.setHtml(\n                        this.$errorText,\n                        message,\n                    );\n    this.$errorText.addClass('entitlement-unenrollment-modal-error-text-visible');\n  }\n\n  setHeaderText(courseName, courseNumber) {\n    this.$headerText.empty();\n    HtmlUtils.setHtml(\n      this.$headerText,\n      HtmlUtils.interpolateHtml(\n        gettext('Are you sure you want to unenroll from {courseName} ({courseNumber})? You will be refunded the amount you paid.'), // eslint-disable-line max-len\n        {\n          courseName,\n          courseNumber,\n        },\n      ),\n    );\n  }\n\n  setSubmitData(apiEndpoint) {\n    this.$submitButton.removeData();\n    this.$submitButton.data('entitlementApiEndpoint', apiEndpoint);\n  }\n\n  switchToSlideOne() {\n    this.$('.entitlement-unenrollment-modal-inner-wrapper header').addClass('hidden');\n    this.$('.entitlement-unenrollment-modal-submit-wrapper').addClass('hidden');\n    this.$('.slide1').removeClass('hidden');\n    this.$('.entitlement-unenrollment-modal-inner-wrapper').prevObject.addClass('entitlement-unenrollment-modal-long-survey');\n\n    // From accessibility_tools.js\n    window.trapFocusForAccessibleModal(\n      this.$previouslyFocusedElement,\n      window.focusableElementsString,\n      this.closeButtonSelector,\n      this.modalId,\n      this.mainPageSelector,\n    );\n  }\n\n  switchToSlideTwo() {\n    const price = this.$(\".reasons_survey input[name='priceEntitlementUnenrollment']:checked\").val();\n    const dissastisfied = this.$(\".reasons_survey input[name='dissastisfiedEntitlementUnenrollment']:checked\").val();\n    const difficult = this.$(\".reasons_survey input[name='difficultEntitlementUnenrollment']:checked\").val();\n    const time = this.$(\".reasons_survey input[name='timeEntitlementUnenrollment']:checked\").val();\n    const unavailable = this.$(\".reasons_survey input[name='unavailableEntitlementUnenrollment']:checked\").val();\n    const email = this.$(\".reasons_survey input[name='emailEntitlementUnenrollment']:checked\").val();\n\n    if (price || dissastisfied || difficult || time || unavailable || email) {\n      const results = { price, dissastisfied, difficult, time, unavailable, email };\n\n      window.analytics.track('entitlement_unenrollment_reason.selected', {\n        category: 'user-engagement',\n        label: JSON.stringify(results),\n        displayName: 'v1',\n      });\n    }\n    this.$('.slide1').addClass('hidden');\n    this.$('.slide2').removeClass('hidden');\n    this.$('.entitlement-unenrollment-modal-inner-wrapper').prevObject.removeClass('entitlement-unenrollment-modal-long-survey');\n\n    // From accessibility_tools.js\n    window.trapFocusForAccessibleModal(\n      this.$previouslyFocusedElement,\n      window.focusableElementsString,\n      this.closeButtonSelector,\n      this.modalId,\n      this.mainPageSelector,\n    );\n  }\n\n  onComplete(xhr) {\n    const status = xhr.status;\n    const message = xhr.responseJSON && xhr.responseJSON.detail;\n\n    if (status === 204) {\n      if (this.isEdx) {\n        this.switchToSlideOne();\n        this.$('.reasons_survey:first .submit-reasons').click(this.switchToSlideTwo.bind(this));\n      } else {\n        EntitlementUnenrollmentView.redirectTo(this.dashboardPath);\n      }\n    } else if (status === 401 && message === 'Authentication credentials were not provided.') {\n      EntitlementUnenrollmentView.redirectTo(`${this.signInPath}?next=${encodeURIComponent(this.dashboardPath)}`);\n    } else {\n      this.setError(this.genericErrorMsg);\n    }\n  }\n\n  static redirectTo(path) {\n    window.location.href = path;\n  }\n}\n\nexport default EntitlementUnenrollmentView;\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/views/entitlement_unenrollment_view.js"],"sourceRoot":""}