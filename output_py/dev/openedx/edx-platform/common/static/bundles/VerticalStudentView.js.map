{"version":3,"sources":["webpack:///./lms/static/completion/js/CompletionOnViewService.js","webpack:///./lms/static/completion/js/ViewedEvent.js","webpack:///./lms/static/js/views/message_banner.js","webpack:///./lms/templates/fields/message_banner.underscore","webpack:///./openedx/features/course_bookmarks/static/course_bookmarks/js/views/bookmark_button.js","webpack:///./xmodule/assets/vertical/public/js/vertical_student_view.js","webpack:///external \"gettext\"?8b52******"],"names":["completedBlocksKeys","Set","markBlocksCompletedOnViewIfNeeded","runtime","containerElement","blockElements","$","find","get","length","tracker","ViewedEventTracker","forEach","blockElement","markCompletedOnViewAfterDelay","parseInt","dataset","addElement","addHandler","event","blockKey","usageId","has","elementHasBeenViewed","ajax","type","url","handlerUrl","data","JSON","stringify","completion","then","add","throttle","fn","wait","time","delay","now","Date","ElementViewing","el","viewedAfterMs","callback","topSeen","bottomSeen","seenForMs","becameVisibleAt","undefined","hasBeenViewed","getBoundingClientRect","setTimeout","checkIfViewed","getTotalTimeSeen","areViewedCriteriaMet","elementViewings","handlers","registerDomHandlers","element","callHandlers","updateVisible","handler","push","elv","rect","getBoundingRect","visible","top","window","innerHeight","markTopSeen","bottom","markBottomSeen","handleVisible","handleNotVisible","onscroll","onresize","define","gettext","_","Backbone","messageBannerTemplate","HtmlUtils","MessageBannerView","View","extend","events","closeBanner","sessionStorage","setItem","hideMessage","initialize","options","isUndefined","defaults","urgency","hideCloseBtn","isRecoveryEmailMsg","isLearnerPortalEnabled","render","message","isNull","$el","html","template","showMessage","getItem","errorMessage","bookmarkText","bookmarkedText","click","showBannerInterval","apiUrl","bookmarkId","bookmarked","setBookmarkState","toggleBookmark","preventDefault","prop","hasClass","removeBookmark","addBookmark","view","usage_id","dataType","success","trigger","error","jqXHR","response","userMessage","responseText","parse","user_message","showError","err","complete","focus","deleteUrl","addClass","attr","text","removeClass","errorText","errorMsg","messageView","bind","SEEN_COMPLETABLES","VerticalStudentView","$element","$bookmarkButtonElement","BookmarkButton","parent"],"mappings":"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","file":"VerticalStudentView.js","sourcesContent":["import { ViewedEventTracker } from './ViewedEvent';\n\nconst completedBlocksKeys = new Set();\n\nexport function markBlocksCompletedOnViewIfNeeded(runtime, containerElement) {\n  const blockElements = $(containerElement).find(\n    '.xblock-student_view[data-mark-completed-on-view-after-delay]',\n  ).get();\n\n  if (blockElements.length > 0) {\n    const tracker = new ViewedEventTracker();\n\n    blockElements.forEach((blockElement) => {\n      const markCompletedOnViewAfterDelay = parseInt(\n        blockElement.dataset.markCompletedOnViewAfterDelay, 10,\n      );\n      if (markCompletedOnViewAfterDelay >= 0) {\n        tracker.addElement(blockElement, markCompletedOnViewAfterDelay);\n      }\n    });\n\n    tracker.addHandler((blockElement, event) => {\n      const blockKey = blockElement.dataset.usageId;\n      if (blockKey && !completedBlocksKeys.has(blockKey)) {\n        if (event.elementHasBeenViewed) {\n          $.ajax({\n            type: 'POST',\n            url: runtime.handlerUrl(blockElement, 'publish_completion'),\n            data: JSON.stringify({\n              completion: 1.0,\n            }),\n          }).then(\n            () => {\n              completedBlocksKeys.add(blockKey);\n              blockElement.dataset.markCompletedOnViewAfterDelay = 0;\n            },\n          );\n        }\n      }\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/completion/js/CompletionOnViewService.js","/** Ensure that a function is only run once every `wait` milliseconds */\nfunction throttle(fn, wait) {\n  let time = 0;\n  function delay() {\n    // Do not call the function until at least `wait` seconds after the\n    // last time the function was called.\n    const now = Date.now();\n    if (time + wait < now) {\n      time = now;\n      fn();\n    }\n  }\n  return delay;\n}\n\n\nexport class ElementViewing {\n  /**\n   * A wrapper for an HTMLElement that tracks whether the element has been\n   * viewed or not.\n   */\n  constructor(el, viewedAfterMs, callback) {\n    this.el = el;\n    this.viewedAfterMs = viewedAfterMs;\n    this.callback = callback;\n\n    this.topSeen = false;\n    this.bottomSeen = false;\n    this.seenForMs = 0;\n    this.becameVisibleAt = undefined;\n    this.hasBeenViewed = false;\n  }\n\n  getBoundingRect() {\n    return this.el.getBoundingClientRect();\n  }\n\n  /** This element has become visible on screen.\n   *\n   * (may be called even when already on screen though)\n   */\n  handleVisible() {\n    if (!this.becameVisibleAt) {\n      this.becameVisibleAt = Date.now();\n      // We're now visible; after viewedAfterMs, if the top and bottom have been\n      // seen, this block will count as viewed.\n      setTimeout(\n        () => {\n          this.checkIfViewed();\n        },\n        this.viewedAfterMs - this.seenForMs,\n      );\n    }\n  }\n\n  handleNotVisible() {\n    if (this.becameVisibleAt) {\n      this.seenForMs = Date.now() - this.becameVisibleAt;\n    }\n    this.becameVisibleAt = undefined;\n  }\n\n  markTopSeen() {\n    // If this element has been seen for enough time, but the top wasn't visible, it may now be\n    // considered viewed.\n    this.topSeen = true;\n    this.checkIfViewed();\n  }\n\n  markBottomSeen() {\n    this.bottomSeen = true;\n    this.checkIfViewed();\n  }\n\n  getTotalTimeSeen() {\n    if (this.becameVisibleAt) {\n      return this.seenForMs + (Date.now() - this.becameVisibleAt);\n    }\n    return this.seenForMs;\n  }\n\n  areViewedCriteriaMet() {\n    return this.topSeen && this.bottomSeen && (this.getTotalTimeSeen() >= this.viewedAfterMs);\n  }\n\n  checkIfViewed() {\n    // User can provide a \"now\" value for testing purposes.\n    if (this.hasBeenViewed) {\n      return;\n    }\n    if (this.areViewedCriteriaMet()) {\n      this.hasBeenViewed = true;\n      // Report to the tracker that we have been viewed\n      this.callback(this.el, { elementHasBeenViewed: this.hasBeenViewed });\n    }\n  }\n}\n\n\nexport class ViewedEventTracker {\n  /**\n   * When the top or bottom of an element is first viewed, and the entire\n   * element is viewed for a specified amount of time, the callback is called,\n   * passing the element that was viewed, and an event object having the\n   * following field:\n   *\n   * *   hasBeenViewed (bool): true if all the conditions for being\n   *     considered \"viewed\" have been met.\n   */\n  constructor() {\n    this.elementViewings = new Set();\n    this.handlers = [];\n    this.registerDomHandlers();\n  }\n\n  /** Add an element to track.  */\n  addElement(element, viewedAfterMs) {\n    this.elementViewings.add(\n     new ElementViewing(\n       element,\n       viewedAfterMs,\n       (el, event) => this.callHandlers(el, event),\n      ),\n    );\n    this.updateVisible();\n  }\n\n  /** Register a new handler to be called when an element has been viewed.  */\n  addHandler(handler) {\n    this.handlers.push(handler);\n  }\n\n  /** Mark which elements are currently visible.\n   *\n   *  Also marks when an elements top or bottom has been seen.\n   * */\n  updateVisible() {\n    this.elementViewings.forEach((elv) => {\n      if (elv.hasBeenViewed) {\n        return;\n      }\n\n      const now = Date.now(); // Use the same \"now\" for all calculations\n      const rect = elv.getBoundingRect();\n      let visible = false;\n\n      if (rect.top > 0 && rect.top < window.innerHeight) {\n        elv.markTopSeen(now);\n        visible = true;\n      }\n      if (rect.bottom > 0 && rect.bottom < window.innerHeight) {\n        elv.markBottomSeen(now);\n        visible = true;\n      }\n      if (rect.top < 0 && rect.bottom > window.innerHeight) {\n        visible = true;\n      }\n\n      if (visible) {\n        elv.handleVisible(now);\n      } else {\n        elv.handleNotVisible(now);\n      }\n    });\n  }\n\n  registerDomHandlers() {\n    window.onscroll = throttle(() => this.updateVisible(), 100);\n    window.onresize = throttle(() => this.updateVisible(), 100);\n    this.updateVisible();\n  }\n\n  /** Call the handlers for all newly-viewed elements and pause tracking\n   *  for recently disappeared elements.\n   */\n  callHandlers(el, event) {\n    this.handlers.forEach((handler) => {\n      handler(el, event);\n    });\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/completion/js/ViewedEvent.js","\n    'use strict';\n    define([\n        'gettext',\n        'jquery',\n        'underscore',\n        'backbone',\n        'templates/fields/message_banner.underscore',\n        'edx-ui-toolkit/js/utils/html-utils'\n    ], function(gettext, $, _, Backbone, messageBannerTemplate, HtmlUtils) {\n        var MessageBannerView = Backbone.View.extend({\n\n            events: {\n                'click .close-btn': 'closeBanner'\n            },\n\n            closeBanner: function(event) {\n                sessionStorage.setItem(\"isBannerClosed\", true);\n                this.hideMessage();\n            },\n\n            initialize: function(options) {\n                if (_.isUndefined(options)) {\n                    options = {};\n                }\n                this.options = _.defaults(options, {\n                    urgency: 'high',\n                    type: '',\n                    hideCloseBtn: true,\n                    isRecoveryEmailMsg: false,\n                    isLearnerPortalEnabled: false\n                });\n            },\n\n            render: function() {\n                if (_.isUndefined(this.message) || _.isNull(this.message)) {\n                    this.$el.html('');\n                } else {\n                    this.$el.html(_.template(messageBannerTemplate)(_.extend(this.options, {  // xss-lint: disable=javascript-jquery-html\n                        message: this.message,\n                        HtmlUtils: HtmlUtils\n                    })));\n                }\n                return this;\n            },\n\n            showMessage: function(message) {\n                this.message = message;\n                if (sessionStorage.getItem(\"isBannerClosed\") == null) {\n                    this.render();\n                }\n            },\n\n            hideMessage: function() {\n                this.message = null;\n                this.render();\n            }\n        });\n\n        return MessageBannerView;\n    });\n\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/views/message_banner.js","module.exports = \"<div class=\\\"banner-msg wrapper-msg urgency-<%- urgency %> <%- type %> <% if (isRecoveryEmailMsg == true) { %> recovery-email-alert <% } %> <% if (isLearnerPortalEnabled == true) { %> learner-portal-enabled-alert <% } %>\\\" role=\\\"alert\\\">\\n  <i <% if (hideCloseBtn == true) { %> hidden <% } %> class=\\\"fa fa-close close-icon close-btn\\\"></i>\\n    <div class=\\\"msg\\\">\\n        <div class=\\\"msg-content\\\">\\n            <div class=\\\"copy\\\">\\n                <p><%= HtmlUtils.HTML(message) %></p>\\n            </div>\\n        </div>\\n    </div>\\n</div>\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lms/templates/fields/message_banner.underscore\n// module id = ./lms/templates/fields/message_banner.underscore\n// module chunks = 26","\n    'use strict';\n\n    define(['gettext', 'jquery', 'underscore', 'backbone', 'js/views/message_banner'],\n        function(gettext, $, _, Backbone, MessageBannerView) {\n            return Backbone.View.extend({\n                errorMessage: gettext('An error has occurred. Please try again.'),\n\n                bookmarkText: gettext('Bookmark this page'),\n                bookmarkedText: gettext('Bookmarked'),\n\n                events: {\n                    click: 'toggleBookmark'\n                },\n\n                showBannerInterval: 5000,   // time in ms\n\n                initialize: function(options) {\n                    this.apiUrl = options.apiUrl;\n                    this.bookmarkId = options.bookmarkId;\n                    this.bookmarked = options.bookmarked;\n                    this.usageId = options.usageId;\n                    this.setBookmarkState(this.bookmarked);\n                },\n\n                toggleBookmark: function(event) {\n                    event.preventDefault();\n\n                    this.$el.prop('disabled', true);\n\n                    if (this.$el.hasClass('bookmarked')) {\n                        this.removeBookmark();\n                    } else {\n                        this.addBookmark();\n                    }\n                },\n\n                addBookmark: function() {\n                    var view = this;\n                    $.ajax({\n                        data: {usage_id: view.usageId},\n                        type: 'POST',\n                        url: view.apiUrl,\n                        dataType: 'json',\n                        success: function() {\n                            view.$el.trigger('bookmark:add');\n                            view.setBookmarkState(true);\n                        },\n                        error: function(jqXHR) {\n                            var response, userMessage;\n                            try {\n                                response = jqXHR.responseText ? JSON.parse(jqXHR.responseText) : '';\n                                userMessage = response ? response.user_message : '';\n                                view.showError(userMessage);\n                            } catch (err) {\n                                view.showError();\n                            }\n                        },\n                        complete: function() {\n                            view.$el.prop('disabled', false);\n                            view.$el.focus();\n                        }\n                    });\n                },\n\n                removeBookmark: function() {\n                    var view = this;\n                    var deleteUrl = view.apiUrl + view.bookmarkId + '/';\n\n                    $.ajax({\n                        type: 'DELETE',\n                        url: deleteUrl,\n                        success: function() {\n                            view.$el.trigger('bookmark:remove');\n                            view.setBookmarkState(false);\n                        },\n                        error: function() {\n                            view.showError();\n                        },\n                        complete: function() {\n                            view.$el.prop('disabled', false);\n                            view.$el.focus();\n                        }\n                    });\n                },\n\n                setBookmarkState: function(bookmarked) {\n                    if (bookmarked) {\n                        this.$el.addClass('bookmarked');\n                        this.$el.attr('aria-pressed', 'true');\n                        this.$el.find('.bookmark-text').text(this.bookmarkedText);\n                    } else {\n                        this.$el.removeClass('bookmarked');\n                        this.$el.attr('aria-pressed', 'false');\n                        this.$el.find('.bookmark-text').text(this.bookmarkText);\n                    }\n                },\n\n                showError: function(errorText) {\n                    var errorMsg = errorText || this.errorMessage;\n\n                    if (!this.messageView) {\n                        this.messageView = new MessageBannerView({\n                            el: $('.message-banner'),\n                            type: 'error'\n                        });\n                    }\n                    this.messageView.showMessage(errorMsg);\n\n                    // Hide message automatically after some interval\n                    setTimeout(_.bind(function() {\n                        this.messageView.hideMessage();\n                    }, this), this.showBannerInterval);\n                }\n            });\n        });\n\n\n\n\n// WEBPACK FOOTER //\n// ./openedx/features/course_bookmarks/static/course_bookmarks/js/views/bookmark_button.js","/* JavaScript for Vertical Student View. */\n\n/* global Set:false */ // false means do not assign to Set\n\n// The vertical marks blocks complete if they are completable by viewing.  The\n// global variable SEEN_COMPLETABLES tracks blocks between separate loads of\n// the same vertical (when a learner goes from one tab to the next, and then\n// navigates back within a given sequential) to protect against duplicate calls\n// to the server.\n\nimport BookmarkButton from 'course_bookmarks/js/views/bookmark_button';\nimport {markBlocksCompletedOnViewIfNeeded} from '../../../../../lms/static/completion/js/CompletionOnViewService.js';\n\nvar SEEN_COMPLETABLES = new Set();\n\nwindow.VerticalStudentView = function(runtime, element) {\n    'use strict';\n    var $element = $(element);\n    var $bookmarkButtonElement = $element.find('.bookmark-button');\n    markBlocksCompletedOnViewIfNeeded(runtime, element);\n    return new BookmarkButton({\n        el: $bookmarkButtonElement,\n        bookmarkId: $bookmarkButtonElement.data('bookmarkId'),\n        usageId: $element.data('usageId'),\n        bookmarked: $element.parent('#seq_content').data('bookmarked'),\n        apiUrl: $bookmarkButtonElement.data('bookmarksApiUrl')\n    });\n};\n\n\n\n// WEBPACK FOOTER //\n// ./xmodule/assets/vertical/public/js/vertical_student_view.js","(function() { module.exports = window[\"gettext\"]; }());\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"gettext\"\n// module id = 3\n// module chunks = 5 7 8 9 11 22 24 26"],"sourceRoot":""}