{"version":3,"sources":["webpack:///./lms/static/js/learner_dashboard/unenrollment_factory.js","webpack:///./lms/static/js/learner_dashboard/views/unenroll_view.js"],"names":["UnenrollmentFactory","options","UnenrollView","defaults","el","triggerElement","$previouslyFocusedElement","survey","document","querySelector","i","children","length","appendChild","Math","trunc","random","$","hide","removeClass","window","trapFocusForAccessibleModal","focusableElementsString","closeButtonSelector","modalId","mainPageSelector","reason","attr","courserunKey","val","analytics","track","category","label","displayName","course_id","addClass","text","urls","dashboard","browseCourses","event","xhr","status","isEdx","location","href","switchToSlideOne","click","switchToSlideTwo","bind","responseText","stop","css","signInUser","encodeURIComponent","gettext","prop","view","$closeButton","$el","triggerSelector","each","index","element","on","handleTrigger","startSubmit","unenrollComplete","Backbone","View"],"mappings":"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","file":"UnenrollmentFactory.js","sourcesContent":["import UnenrollView from './views/unenroll_view';\n\nfunction UnenrollmentFactory(options) {\n  return new UnenrollView(options);\n}\n\nexport { UnenrollmentFactory }; // eslint-disable-line import/prefer-default-export\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/unenrollment_factory.js","/* globals gettext */\n\nimport Backbone from 'backbone';\n\nclass UnenrollView extends Backbone.View {\n\n  constructor(options) {\n    const defaults = {\n      el: '.unenroll-modal',\n    };\n    super(Object.assign({}, defaults, options));\n  }\n\n  handleTrigger(triggerElement) {\n    this.$previouslyFocusedElement = triggerElement;\n  }\n\n  switchToSlideOne() {\n    // Randomize survey option order\n    const survey = document.querySelector('.options');\n    for (let i = survey.children.length - 1; i >= 0; i -= 1) {\n      survey.appendChild(survey.children[Math.trunc(Math.random() * i)]);\n    }\n    this.$('.inner-wrapper header').hide();\n    this.$('#unenroll_form').hide();\n    this.$('.slide1').removeClass('hidden');\n\n    if (window.trapFocusForAccessibleModal) {\n      window.trapFocusForAccessibleModal(\n        this.$previouslyFocusedElement,\n        window.focusableElementsString,\n        this.closeButtonSelector,\n        this.modalId,\n        this.mainPageSelector,\n      );\n    }\n  }\n\n  switchToSlideTwo() {\n    let reason = this.$(\".reasons_survey input[name='reason']:checked\").attr('val');\n    const courserunKey = $('#unenroll_course_id').val() + $('#unenroll_course_number').val();\n    if (reason === 'Other') {\n      reason = this.$('.other_text').val();\n    }\n    if (reason) {\n      window.analytics.track('unenrollment_reason.selected', {\n        category: 'user-engagement',\n        label: reason,\n        displayName: 'v1',\n        course_id: courserunKey,\n      });\n    }\n    this.$('.slide1').addClass('hidden');\n    this.$('.survey_course_name').text(this.$('#unenroll_course_name').text());\n    this.$('.slide2').removeClass('hidden');\n    this.$('.reasons_survey .return_to_dashboard').attr('href', this.urls.dashboard);\n    this.$('.reasons_survey .browse_courses').attr('href', this.urls.browseCourses);\n\n    if (window.trapFocusForAccessibleModal) {\n      window.trapFocusForAccessibleModal(\n        this.$previouslyFocusedElement,\n        window.focusableElementsString,\n        this.closeButtonSelector,\n        this.modalId,\n        this.mainPageSelector,\n      );\n    }\n  }\n\n  unenrollComplete(event, xhr) {\n    if (xhr.status === 200) {\n      if (!this.isEdx) {\n        location.href = this.urls.dashboard;\n      } else {\n        this.switchToSlideOne();\n        this.$('.reasons_survey:first .submit_reasons').click(this.switchToSlideTwo.bind(this));\n      }\n    } else if (xhr.status === 400) {\n      $('#unenroll_error').text(\n        xhr.responseText,\n      ).stop()\n       .css('display', 'block');\n    } else if (xhr.status === 403) {\n      location.href = `${this.urls.signInUser}?course_id=${\n        encodeURIComponent($('#unenroll_course_id').val())}&enrollment_action=unenroll`;\n    } else {\n      $('#unenroll_error').text(\n        gettext('Unable to determine whether we should give you a refund because' +\n                ' of System Error. Please try again later.'),\n      ).stop()\n       .css('display', 'block');\n    }\n  }\n\n  startSubmit() {\n    this.$('.submit').prop('disabled', true);\n  }\n\n  initialize(options) {\n    const view = this;\n    this.urls = options.urls;\n    this.isEdx = options.isEdx;\n\n    this.closeButtonSelector = '.unenroll-modal .close-modal';\n    this.$closeButton = $(this.closeButtonSelector);\n    this.modalId = `#${this.$el.attr('id')}`;\n    this.mainPageSelector = '#dashboard-main';\n\n    this.triggerSelector = '.action-unenroll';\n    $(this.triggerSelector).each((index, element) => {\n      $(element).on('click', view.handleTrigger.bind($(element)));\n    });\n\n    this.$('.submit .submit-button').on('click', this.startSubmit.bind(this));\n    $('#unenroll_form').on('ajax:complete', this.unenrollComplete.bind(this));\n  }\n}\n\nexport default UnenrollView;\n\n\n\n// WEBPACK FOOTER //\n// ./lms/static/js/learner_dashboard/views/unenroll_view.js"],"sourceRoot":""}